var traitDescs = ["skateboard","owl","ananas","piece of shit","sunflower","ice cream cone left hand","bloody golden knive","violet hookah","red balloon","dumbbell in left hand","bloody sword","green bottle","trident","pitchfork","crowbar","rifle","money bag in left hand","black brief case","dynamite","fish","boombox", "walking stick", "cactus","ice cream cone in right hand","magic wand","tulip","knive","basketball","green hookah","blue balloon","banana","dumbbell in right hand","sword in right hand","beer in right hand","brown bottle","letter","anchor","leather briefcase","money bag in right hand","black boots", "pink boots", "orange boots", "white boots","sand boots","yellow rubber boots","green rubber boots","sandals","blue uggs", "green uggs", "sand uggs","brown boots","black loafer","brown loafer", "violet sneakers", "yellow sneakers","white sneakers","black sneakers","green sneakers","red sneakers","grey sneakers","black cowboy boots","white cowboy boots","brown cowboy boots","red bobble hat","blue bobble hat","cook hat","prison hat","police hat","crown","black beanie","green beanie","white beanie","red beanie","white cowboy hat","brown cowboy hat","panama hat","graduate hat","white basecap","gold basecap","green basecap","blue basecap","black basecap","red basecap","orange basecap","pink basecap","blue forward cap","grey forward cap","maga cap","christmas hat","cat on head","tophat","sombrero","sun hat","pirate hat","rasta hat","nurse hat","viking helmet","safety helmet","tinfoil hat","violet shades","black shades","white glasses","gold glasses","blue glasses","green glasses","pink glasses","orange glasses","red glasses","black glasses","mirror glasses","nerd glasses","chicken","parrot","black bandana","red bandana","blue bandana","pipe","cigar","cigarette","violet-yellow headband","red-white headband","face mask","eye mask","eye patch","black braces","white braces","red braces","red scarf","black scarf","white scarf","white parisian scarf","black parisian scarf","red parisian scarf","chain with clock","chain with cross upside down","chain with cross","blue messy tie","black messy tie","red messy tie","red tie","black tie","blue tie","golden key chain","silver key chain","boxing belt","leather belt","gold chain","rings","bracelet right arm","bracelet left arm","handcuffs","gloves","undershirt","dirty undershirt","bloody undershirt","white muscle shirt","pink rainbow shirt","white rainbow shirt","black rainbow shirt","grey muscle shirt","blue-white sport shirt","yellow-black sport shirt","violet-yellow sport shirt","red sport shirt","gold cape","blue cape","white cape","green cape","red cape","green bra","gold bra","pink bra","black bra","red bra ","spido shirt","red spaghetti top","green spaghetti top","black belly free shirt","white belly free shirt","police uniform","red-white striped shirt","blue-white striped shirt","open black shirt","open blue shirt","open green shirt", "open violet shirt", "open yellow shirt", "open pink shirt","open white shirt","bellboy jacket","white nipple free shirt","pink nipple free shirt","blue nipple free shirt","open black shirt with red knobs","open grey shirt","nurse shirt","white heart shirt","yellow heart shirt","black bitcoin shirt","red bitcoin shirt","white shirt","vertical striped blue-white shirt","vertical striped yellow-white shirt","vertical striped red-white shirt","grey shirt","orange prison shirt","black-white prison shirt","open camouflage shirt","camouflage longsleeve","longsleeve with red stripes","green bulletproof vest","dark bulletproof vest","felt jacket","blue jacket","plaid jacket","black jacket with blue shirt", "green jacket", "yellow jacket", "violet jacket", "red jacket","black jacket","colorful longsleeve","colorful longsleeve with dark background","anchor longsleeve","black longsleeve with skull","white longsleeve with skull","pink longsleeve","black longsleeve with alien","white longsleeve","green longsleeve","yellow longsleeve with smile","yellow longsleeve  ","red longsleeve","black longsleeve  ","blue longsleeve","safety vest","black socks","white socks","yellow-white socks","green-white socks","blue-white socks","red-white socks","pink socks","red overknee socks","diaper","pissed white pants", "plaid boxer shorts", "red-black boxer shorts", "striped boxer shorts", "grey boxer shorts", "pink string","green string","red string","blue string","gold string","black string","white string","red hot pants","black fishnet","red fishnet","red sport shorts","violet-yellow sport shorts","spido pants","split pants", "blue shorts", "green shorts", "white shorts", "yellow shorts", "pink shorts", "black shorts","white pants","plaid black-white pants","plaid black-red pants","black-white prison pants","orange prison pants","blue jeans","plaid red-white shorts","plaid black-white shorts","plaid red-black shorts","plaid green-black shorts","camouflage pants","beige pants","blue pants","pink pants","brown pants","black pants","yellow pants","green pants","red pants","cyborg","silver eyebrow piercing left","silver eyebrow piercing right","golden eyebrow piercing right","golden eyebrow piercing left","silver stud earring right","silver stud earring left","large earring left","large earring right","golden stud earring right","golden stud earring left","belly button piercing","nipple piercing","nipple chain","silver nosering","golden nosering","gouged eye left","gouged eye right","blue eye left","blue eye right","shoulder scar","face scar","belly scar","arm scar","tattoos on left leg","tattoos on right leg","tattoos on left arm","tattoos on right arm","skull tattoo black","skull tattoo black-white","heart tattoo","bitcoin tattoo","rainbow tattoo","silver genital piercing","golden genital piercing","body hair","pimples","fringe black","fringe brown","fringe grey","fringe red","fringe blonde","light brown residual hair","red residual hair","grey residual hair","blonde residual hair","black horseshoe hairline","light brown horseshoe hairline","red horseshoe hairline","grey horseshoe hairline","blonde horseshoe hairline","red blowout","light brown blowout","black blowout","grey blowout","blonde blowout","long curls grey","long curls red","long curls black","long curls light brown","long curls blonde","red stubbles","blonde stubbles","black stubbles","black sidecut","light brown sidecut","red sidecut","grey sidecut","blonde sidecut","double mohawk","blonde mohawk","black mohawk","red mohawk","blue mohawk","green mohawk","red buzzcut","black buzzcut","brown buzzcut","blonde buzzcut","dark brown bowl","light brown bowl","grey bowl","black bowl","red bowl","blonde bowl","wild grey hair","wild orange hair","wild pink hair","wild black hair","wild blue hair","wild red hair","wild green hair","wild dark brown hair","wild light brown hair","wild blonde hair","flat top red","flat top black","flat top blonde","flat top light brown","flat top grey","straight long black hair","straight long light brown hair","straight long red hair","straight long grey hair","straight long blonde hair","pigtail","grey messy hair","red messy hair","light brown messy hair","black messy hair","blonde messy hair","short brown fringe","short red fringe","short light brown fringe","short black fringe","short blonde fringe","sharp dark brown flattop","sharp light brown flattop","sharp black flattop","sharp red flattop","sharp blonde flattop","shoulder-length orange hair","shoulder-length pink hair","shoulder-length black hair","shoulder-length blue hair","shoulder-length green hair","shoulder-length red hair","shoulder-length dark brown hair","shoulder-length light brown hair","shoulder-length blonde hair","dark brown pompadour","red pompadour","black pompadour","light brown pompadour","blonde pompadour","wide mouth with missing teeth","wide mouth with gold teeth","wide mouth with missing incisors","wide mouth with one teeth","wide mouth","quiet smile","smile","sad mouth","sceptical mouth","staggered mouth with gold teeth","staggered mouth with black teeth","staggered mouth","long red beard","long black beard","long light brown beard","long brown beard","long grey beard","long blonde beard","blonde beard","grey beard","brown beard","red beard","light brown beard","red goatee","light brown goatee","blonde goatee","grey goatee","brown goatee","van dyke red","van dyke blonde","van dyke grey","van dyke light brown","van dyke brown","red zappa beard","blonde zappa beard","grey zappa beard","light brown zappa beard","brown zappa beard","red dali beard","blonde dali beard","grey dali beard","light brown dali beard","brown dali beard","brown handlebar","light brown handlebar","grey handlebar","red handlebar","blonde handlebar","grey mustache","red mustache","blonde mustache","light brown mustache","brown mustache","petite goatee light brown","petite goatee red","petite goatee grey","petite goatee brown","petite goatee blonde","red extended handlebar","grey extended handlebar","light brown extended handlebar","blonde extended handlebar","grey mutton chops","light brown mutton chops","red mutton chops","brown mutton chops","blonde mutton chops","light brown chin strap","grey chin strap","red chin strap","blonde chin strap","light brown dutch beard","red dutch beard","grey dutch beard","blonde dutch beard","brown dutch beard","white eyes","grey eyes","brown eyes","green eyes","red eyes","blue eyes","white skin with penis","white skin without genitals","white skin with vagina","zombie with penis","zombie without genitals","zombie with vagina","dark brown skin with penis","dark brown skin with vagina","dark brown skin without genitals","piggy skin with vagina","piggy skin without genitals","piggy skin with penis","ape with vagina","ape without genitals","ape with penis","brown with penis","brown with vagina","brown without genitals"];
var Contract;
var LoveContract;
const abi = '[{"inputs":[{"internalType":"string","name":"_name","type":"string"},{"internalType":"string","name":"_symbol","type":"string"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"previousArweaveHash","type":"string"},{"indexed":false,"internalType":"string","name":"newArweaveHash","type":"string"},{"indexed":false,"internalType":"string","name":"previousIpfsHash","type":"string"},{"indexed":false,"internalType":"string","name":"newIpfsHash","type":"string"}],"name":"GeneratorUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"dudeID","type":"uint256"},{"indexed":false,"internalType":"string","name":"previousName","type":"string"},{"indexed":false,"internalType":"string","name":"newName","type":"string"}],"name":"NameUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"dudeId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"niftiness","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"power","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"swag","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"wealth","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"empathy","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"health","type":"uint256"}],"name":"SkillChange","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"baseURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"singleTraits","type":"uint256[]"},{"internalType":"uint256[]","name":"bodyTraits","type":"uint256[]"},{"internalType":"uint256[]","name":"dresstop","type":"uint256[]"},{"internalType":"uint256[]","name":"dressbottom","type":"uint256[]"},{"internalType":"uint256[]","name":"accessoires","type":"uint256[]"}],"name":"purchase","outputs":[],"stateMutability":"payable","type":"function","payable":true},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_basePrice","type":"uint256"},{"internalType":"uint256","name":"_traitPrice","type":"uint256"},{"internalType":"uint256","name":"_freeTraits","type":"uint256"}],"name":"changePrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"baseURI","type":"string"}],"name":"setBaseURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getRemovedTraits","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getTraits","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getSkills","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"string","name":"newArweave","type":"string"},{"internalType":"string","name":"newIpfs","type":"string"}],"name":"setGeneratorHashes","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getArweaveImgHash","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"getIpfsImgHash","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"getArweaveGeneratorHash","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"getIpfsGeneratorHash","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"uint256","name":"traitCombi","type":"uint256"}],"name":"isUnique","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"totalLegendarySupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"totalGoldSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"totalSilverSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[],"name":"totalUltimateSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"setSkills","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"pauseMinting","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"unpauseMinting","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"activateSkills","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenID","type":"uint256"}],"name":"getName","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"uint256","name":"tokenID","type":"uint256"},{"internalType":"string","name":"newName","type":"string"}],"name":"updateName","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"nameString","type":"string"}],"name":"isNameReserved","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function","constant":true},{"inputs":[{"internalType":"string","name":"newName","type":"string"}],"name":"isNameAllowed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"pure","type":"function","constant":true}]';
const loveAbi = '[{"inputs":[{"internalType":"string","name":"name_","type":"string"},{"internalType":"string","name":"symbol_","type":"string"},{"internalType":"address","name":"dudesAddress","type":"address"},{"internalType":"address","name":"sistasAddress","type":"address"},{"internalType":"uint256","name":"emissionStartTimestamp","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[],"name":"INITIAL_ALLOTMENT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"SECONDS_IN_A_DAY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_address","type":"address"},{"internalType":"uint256","name":"tokenIndex","type":"uint256"}],"name":"accumulated","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenIndex","type":"uint256"}],"name":"accumulatedForDude","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenIndex","type":"uint256"}],"name":"accumulatedForSista","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"burnQuantity","type":"uint256"}],"name":"burn","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenIndices","type":"uint256[]"}],"name":"claimForDudes","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenIndices","type":"uint256[]"}],"name":"claimForSistas","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"emissionEnd","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"emissionPerDay","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"emissionStart","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenIndex","type":"uint256"}],"name":"lastClaim","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}]';
const contractAddr = '0x892555E75350E11f2058d086C72b9C94C9493d72';
const loveContractAddr = '0xBA05A7ca74610631a1CF4967CD7358f61EBd37e9';

$(document).ready(function() {

    init();

    $("#login").click(function() {
        login();
    });

});

function init() {
    if (typeof window.web3 !== 'undefined' && window.web3.currentProvider.selectedAddress != null) {
        if (window.ethereum) {
            window.web3 = new Web3(ethereum);
        } else if (window.web3) {
            window.web3 = new Web3(web3.currentProvider);
        }
        $("#loginState").text("Connected to " + window.web3.currentProvider.selectedAddress);
    } else {
        window.web3 = new Web3(new Web3.providers.HttpProvider("https://mainnet.infura.io/v3/5c7df338a99243d2904e2d2106e9a7b6"));
    }

    Contract = new window.web3.eth.Contract(JSON.parse(abi), contractAddr);
    LoveContract = new window.web3.eth.Contract(JSON.parse(loveAbi), loveContractAddr);

    web3.eth.handleRevert = true;

}

function getAbi() {
    $.getJSON( 'https://niftydudes.com/scripts/Niftydudes.json', function( data ) {
      console.log(JSON.stringify(data.abi));
    });
}

async function login() {
    // Modern dapp browsers...
    if (window.ethereum) {
        window.web3 = new Web3(ethereum);
        try {
            // Request account access if needed
            //await window.ethereum.enable();
            accounts = await ethereum.request({
                method: 'eth_requestAccounts'
            });
            console.log("Account: " + accounts[0]);
            // Acccounts now exposed
            $("#loginState").text("Connected to " + accounts[0]);
            //personalSign();
            Contract = new window.web3.eth.Contract(JSON.parse(abi), contractAddr);
        } catch (error) {
            // User denied account access...
        }
    // Legacy dapp browsers
    } else if (window.web3) {
        window.web3 = new Web3(web3.currentProvider);
        // Acccounts always exposed
        if(typeof accounts !== 'undefined') {
            $("#loginState").text("Connected to " + accounts[0]);
            //personalSign();
            Contract = new window.web3.eth.Contract(JSON.parse(abi), contractAddr);
        } else {
            $("#loginState").text("Non-Ethereum browser detected. Consider installing MetaMask!");
        }
    } else {
        $("#loginState").text("Non-Ethereum browser detected. Consider installing MetaMask!");
    }
    localStorage.setItem('currentAddress', accounts[0]);
}

async function getRemovedTraits() {
    return await Contract.methods.getRemovedTraits().call().then(function(result) {
        return result;
    });
}

async function tokenOfOwnerByIndex(index) {
    return await Contract.methods.tokenOfOwnerByIndex(accounts[0], index).call().then(function(result) {
        return result;
    });
}

async function isUnique(traitCombination) {
    return await Contract.methods.isUnique(traitCombination).call().then(function(result) {
        return result;
    });
}

async function personalSign() {
    var text = "This is my message";

    window.web3.eth.personal.sign(text, accounts[0])
        .then((signed) => {
            console.log('Signed!  Result is: ', signed);
            console.log('Recovering...');

            $.get("login/" + accounts[0] + "?signature=" + signed, function(data) {
                $(".result").html(data);
                if (data) {}
            });
        });
}


async function fillTraitList(tokenID) {
    Contract.methods.getTraits(tokenID).call().then(function(result) {

        var array = result.match(/.{1,3}/g);

        $("#detailsDesc").text("Dude #" + tokenID + " has the following " + array.length + " traits:");
        
        for(var i = 0; i< array.length; i++) {
            (function (_i) {
                $("#traitList").append("<li>" + traitDescs[array[_i]-100] + " (" + array[_i] + ")</li>");
            })(i);  
        }
    });
}

async function getOwner(id) {
    return await Contract.methods.ownerOf(id).call().then(function(result) {
        return result;
    });
}

async function isConnected() {
    return await window.web3.eth.net.isListening().then(function(result) {
        return result;
    });
}